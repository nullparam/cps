<!DOCTYPE html><html><head><title>全网搜 特惠购</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/minireset.css/0.0.2/minireset.css"><link rel="stylesheet" href="https://at.alicdn.com/t/font_1534407_wok1jkjgio.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css"><script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script><script src="https://cdn.staticfile.org/vue/2.6.10/vue.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script><!--pc端click代替touch--><script src="https://cdn.jsdelivr.net/npm/@vant/touch-emulator"></script><script src="//img.bc.haodanku.com/cms/utils.v1_0_2.js"></script><style>*{-webkit-tap-highlight-color:transparent}*,body,html{padding:0;margin:0}body,html{background:#da2702}.root-rem-calc,html{font-size:13.33333vw}@media only screen and (min-width:540px){.root-rem-calc,html{font-size:72px}}.max-width{max-width:7.5rem;margin:auto}.ellipsis-single{white-space:nowrap}.ellipsis-multiple,.ellipsis-single{overflow:hidden;text-overflow:ellipsis}.ellipsis-multiple{display:-webkit-box;-webkit-box-orient:vertical;white-space:normal}[v-cloak]{display:none}.banner-wrapper{display:block;width:7.5rem;min-height:3.4rem}.page-container{min-height:100vh;max-width:7.5rem;background:#da2702;padding-bottom:1.76rem;margin:0 auto;box-sizing:border-box;font-size:.32rem}.layui-layer{font-size:12px}::-webkit-scrollbar{all:unset;width:0;height:0}::-webkit-scrollbar-thumb{border-radius:.05rem;background-color:#c1c1c1}@media screen and (min-width:750px){::-webkit-scrollbar{width:.05rem;height:.05rem}}.van-toast--html,.van-toast--text{font-size:.24rem}@media (-webkit-min-device-pixel-ratio:1.5),(min-device-pixel-ratio:1.5){.border-1px:after{transform:scaleY(.7)}.border-1px-v:after{transform:scaleX(.7)}.border-1px-all{position:relative}.border-1px-all:after{display:block;position:absolute;width:150%;height:150%;left:50%;top:50%;transform:translate(-50%,-50%) scale(.66667);content:""}}@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2){.border-1px:after{transform:scaleY(.5)}.border-1px-v:after{transform:scaleX(.5)}.border-1px-all{position:relative}.border-1px-all:after{display:block;position:absolute;width:200%;height:200%;left:50%;top:50%;transform:translate(-50%,-50%) scale(.5);content:""}}.free-loading{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:.6rem 0}.free-loading>p{font-size:.3rem;color:#fff;letter-spacing:.01rem;margin:.2rem 0 0}.free-loading .la-line-scale{width:1.6rem;height:1.28rem;display:block;font-size:0;color:#da2702}.free-loading .la-line-scale>div{display:inline-block;float:none;background-color:currentColor;border:0 solid;width:.16rem;height:1.28rem;margin:0 .08rem;border-radius:0;-webkit-animation:line-scale 1.2s ease infinite;animation:line-scale 1.2s ease infinite}.free-loading .la-line-scale>div:first-child{-webkit-animation-delay:-1.2s;animation-delay:-1.2s}.free-loading .la-line-scale>div:nth-child(2){-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.free-loading .la-line-scale>div:nth-child(3){-webkit-animation-delay:-1s;animation-delay:-1s}.free-loading .la-line-scale>div:nth-child(4){-webkit-animation-delay:-.9s;animation-delay:-.9s}.free-loading .la-line-scale>div:nth-child(5){-webkit-animation-delay:-.8s;animation-delay:-.8s}@-webkit-keyframes line-scale{0%,40%,to{transform:scaleY(.4)}20%{transform:scaleY(1)}}@keyframes line-scale{0%,40%,to{transform:scaleY(.4)}20%{transform:scaleY(1)}}.free-share{position:fixed;bottom:0;width:7.5rem;height:1.76rem;background:linear-gradient(180deg,hsla(0,0%,100%,0),#da2702 50%);padding:.32rem .24rem;box-sizing:border-box;z-index:100;cursor:pointer}.free-share #share_href{display:flex;align-items:center;justify-content:center;width:6.22rem;height:.9rem;margin:auto;background:linear-gradient(180deg,#fff8e6,#fdeabf);border-radius:.45rem;text-align:center;color:#da2702;font-size:.324rem;line-height:1em}.free-share #share_href #svg-icon{margin-top:.05rem;margin-right:.1rem;height:1em}.free-share #share_href #svg-icon .cls-1,.free-share #share_href #svg-icon .cls-2{fill:none;stroke:currentColor;stroke-linejoin:round;stroke-width:2px}.free-share #share_href #svg-icon .cls-2{stroke-linecap:round}.page-container{font-family:PingFang SC}.page-container .banner-wrapper{height:3.34rem}.page-container .fixed-block{padding-top:.2rem;background-color:#da2702}.page-container .fixed-block .search-box{padding:0 .54rem}.page-container .fixed-block .search-box .van-search{padding-top:.04rem;padding-bottom:.04rem;padding-right:.04rem;height:.72rem;background:#fff;border-radius:.1rem}.page-container .fixed-block .search-box .van-search .van-field__body,.page-container .fixed-block .search-box .van-search .van-field__control,.page-container .fixed-block .search-box .van-search .van-search__content{height:100%}.page-container .fixed-block .search-box .van-search .van-search__content{background:#fff;padding-left:0}.page-container .fixed-block .search-box .van-search .van-search__action{line-height:.64rem;height:100%;width:1.1rem;background:#ffe3dd;border-radius:.1rem;text-align:center;font-size:.26rem;font-weight:400;color:#fd471f}.page-container .fixed-block .search-box .van-search .van-field__control{font-size:.26rem;font-weight:400;color:#575556}.page-container .fixed-block .search-box .van-search .van-cell{display:inline-flex;align-items:center}.page-container .fixed-block .search-box .van-search .van-field__clear,.page-container .fixed-block .search-box .van-search .van-icon-search{font-size:.26rem}.page-container .fixed-block .search-box .van-search .van-field__left-icon{line-height:.65rem}.page-container .fixed-block .hot-key{margin-top:.15rem;font-size:0;white-space:nowrap;overflow-x:auto}.page-container .fixed-block .hot-key li{display:inline-flex;align-items:center;vertical-align:top;margin-right:.37rem;padding:0 .18rem;height:.4rem;background:#c42302;border-radius:.2rem;font-size:.22rem;font-weight:500;color:#ffab48;cursor:pointer}.page-container .fixed-block .hot-key li.active{color:#fefefe;background:#fd471f;border:1px solid #fff;cursor:default;pointer-events:none}.page-container .fixed-block .share-box{margin:.3rem -.54rem 0;padding-left:.2rem;font-size:0;white-space:nowrap;overflow-x:auto;overflow-y:hidden}.page-container .fixed-block .share-box li{display:inline-block;vertical-align:top;box-sizing:content-box;margin-right:.18rem;width:3rem;height:1.27rem;background:#b2122a;border-radius:.05rem;cursor:pointer}.page-container .fixed-block .nav{position:relative;display:flex;align-items:center;justify-content:space-between;margin-top:.3rem;margin-bottom:.1rem}.page-container .fixed-block .nav li{position:relative;z-index:1;width:1.5rem;height:.6rem;border-radius:10px;font-size:.26rem;font-weight:500;color:#ffc148;line-height:.6rem;text-align:center;background-size:0;cursor:pointer}.page-container .fixed-block .nav li.active{color:#fff;background-size:auto .5rem;background-position:100% 100%;background-repeat:no-repeat;cursor:default}.page-container .fixed-block .nav .bg{position:absolute;top:0;background:#ff522c;transition:left .25s}.page-container .fixed-block .nav .bg:after{position:absolute;top:100%;left:50%;margin-left:-.05rem;border:.1rem solid transparent;border-top-color:#ff522c;content:""}.page-container .fixed-block.fixed{width:7.5rem}.page-container .fixed-block.fixed .share-box,.page-container .fixed-block.fixed .van-icon-search{display:none}.page-container .fixed-block.fixed+.page-content{margin-top:2.54rem}.page-container .goods-card{background:#fff;display:flex;align-items:center;padding:.2rem;margin-bottom:.2rem;border-radius:.2rem;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.page-container .goods-card>img{width:2.3rem;height:2.3rem;border-radius:.1rem;filter:contrast(97%)}.page-container .goods-card .detail{position:relative;width:calc(100% - 2.3rem);padding-left:.2rem;box-sizing:border-box}.page-container .goods-card .detail .ticket{display:inline-flex;align-items:center;height:.38rem;padding:1px 1px 1px 0;box-sizing:border-box;background:linear-gradient(0deg,#ff753c,#ff4b42);border-radius:2px;font-size:0;font-family:Microsoft YaHei}.page-container .goods-card .detail .ticket .name,.page-container .goods-card .detail .ticket .value{padding:0 .05rem;font-size:.25rem;font-family:Microsoft YaHei}.page-container .goods-card .detail .ticket .name{line-height:1em;font-weight:300;color:#fff}.page-container .goods-card .detail .ticket .value{display:flex;align-items:center;height:100%;font-weight:400;color:#ff4d42;background:#fff}.page-container .goods-card .detail .price{font-size:.24rem;font-family:PingFang SC;font-weight:700;line-height:1em}.page-container .goods-card .detail .price.has-share{padding-right:.5rem}.page-container .goods-card .detail .price .discount{color:#f23015;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.page-container .goods-card .detail .price .discount strong{font-size:.44rem;line-height:1em}.page-container .goods-card .detail .price .price-bottom{margin-top:.1rem}.page-container .goods-card .detail .price .price-bottom>div{display:inline-block;vertical-align:top}.page-container .goods-card .detail .price .price-bottom .origin{font-weight:500;text-decoration:line-through;color:#b9b9b9}.page-container .goods-card .detail .price .price-bottom .sales{float:right;color:#a09f9f}.page-container .goods-card .detail .price .price-bottom .sales .name{margin-right:2px}.page-container .goods-card .detail .icon{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:.3rem;width:auto;margin-right:2px}.page-container .goods-card .detail .title{display:flex;align-items:center;font-size:.3rem;font-weight:500;color:#000;margin:0}.page-container .goods-card .detail .title span{flex:1;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.page-container .goods-card .detail .tm-icons+div{margin-top:0}.page-container .goods-card .detail .center{margin:.2rem 0}.page-container .goods-card .detail .share{position:absolute;top:.8rem;right:-.2rem;width:1.03rem;font-size:.26rem;font-weight:500;padding-left:.1rem;border-radius:.28rem 0 0 .28rem;cursor:pointer;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:1;height:.56rem;color:#f23015;background:#ffefed;display:flex;justify-content:center;align-items:center}.page-container .goods-card .detail .footer{display:flex;justify-content:space-between;align-items:flex-end}.page-container .goods-card .detail .footer .operation{width:1.87rem;height:.64rem;font-size:.28rem;font-weight:700;color:#bd1d14;background:linear-gradient(0deg,#ffcd62,#fde989);display:flex;justify-content:center;align-items:center;border-radius:.36rem;cursor:pointer}.page-container .goods-card .detail .footer .operation.sell-out{background:#eee;color:#ccc;cursor:default}.page-container .goods-card.heji .center{display:flex;align-items:center;justify-content:space-between;margin:.1rem 0 .45rem}.page-container .goods-card.heji .center .month-sale{font-size:.2rem;font-family:PingFang SC;font-weight:400;color:#999}.page-container .goods-card.heji .today-sale{width:2.56rem;height:.4rem;background:linear-gradient(90deg,#ffeeeb,#fff);border-radius:.2rem;font-size:.22rem;font-family:PingFang SC;font-weight:500;color:#b0361e;line-height:.4rem;text-indent:.1rem}.page-container .goods-card.heji .today-sale strong{font-size:.3rem;color:#f23015}.page-container .goods-card.heji .footer{display:block;font-size:0}.page-container .goods-card.heji .footer .price{display:flex;align-items:baseline;margin-bottom:.2rem}.page-container .goods-card.heji .footer .price>div{font-size:.22rem;font-family:PingFang SC;font-weight:500;width:auto}.page-container .goods-card.heji .footer .discount{margin-right:.1rem;color:#ef2735}.page-container .goods-card.heji .footer .discount strong{font-size:.3rem;color:#ef2735}.page-container .goods-card.heji .footer .origin{text-decoration:line-through;color:#b9b9b9}.page-container .goods-card.heji .btn-block{position:absolute;right:0;bottom:0}.page-container .goods-card.heji .btn-block>div{width:1.3rem;height:.55rem;box-sizing:border-box;line-height:.55rem;margin-right:-.2rem;font-size:.24rem;border-radius:.28rem 0 0 .28rem;text-align:center}.page-container .goods-card.heji .btn-block .btn-share{background:#fff9f3;border:1px dashed #f5a15c;border-right:0;color:#ff6728;cursor:pointer}.page-container .goods-card.heji .btn-block .btn-order{margin-top:.07rem;background:linear-gradient(90deg,#fe3a3f,#faa450);box-shadow:0 .05rem .1rem 0 rgba(215,21,55,.2);color:#fff;cursor:pointer}.page-container .free-loading .la-line-scale{color:#fff}.page-container .page-content{padding:.2rem 0;border-radius:.26rem;background:#ff522c;transition:padding .3s}.page-container .page-content.empty-list{padding:1rem 0}.page-container .page-content .free-lists{width:7.1rem;margin:auto}.page-container .list-item-loading{text-align:center;padding:.2rem 0 .4rem;color:#fff;font-size:.24rem;letter-spacing:.01rem}.page-container .van-overlay{display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000}</style></head><body><template id="c-share">
  <div class="free-share">
    <div id="share_href" v-on:click="handleShare">
      <i>
        <svg xmlns="http://www.w3.org/2000/svg" id="svg-icon" data-name="图层 1" viewBox="0 0 18 19.11">
          <title>分享</title>
          <path class="cls-1" d="M17.5,8A2.5,2.5,0,1,0,15,5.5,2.5,2.5,0,0,0,17.5,8Z" transform="translate(-3 -2)"/>
          <path class="cls-1" d="M6.5,14.5A2.5,2.5,0,1,0,4,12,2.5,2.5,0,0,0,6.5,14.5Z" transform="translate(-3 -2)"/>
          <path class="cls-2" d="M15,6.79,8.67,10.62" transform="translate(-3 -2)"/>
          <path class="cls-2" d="M8.67,13.28,13.27,16" transform="translate(-3 -2)"/>
          <path class="cls-1" d="M15.77,15.11a2.5,2.5,0,1,1-2.5,2.5A2.5,2.5,0,0,1,15.77,15.11Z"
                transform="translate(-3 -2)"/>
        </svg>
      </i>
      <span>分享好友</span>
    </div>
  </div>
</template>
<script>
Vue.component("share", {
  template: "#c-share",
  methods: {
    handleShare: function () {
      this.$emit("share");
    }
  }
});
</script>
<template id="c-list-item">
  <div class="goods-card heji">
    <img v-lazy="item.itempic" v-if="item.itempic">
    <img src="http://img.bc.fqapps.com/fudai13cae4ae6ef16739ed3b100a2ec39e97.gif" alt="" v-else>
    <div class="detail">
      <div class="title">
        <img
          class="icon"
          :src="iconUrl"
          alt="">
        <span>{{ item.itemshorttitle || item.itemtitle || item.goodsnameshort || item.goodsname }}</span>
      </div>
      <div class="center">
        <div class="today-sale">
          <i class="iconfont hdk-huo"></i>月销 {{getMoneyStr(item.itemsale)}}
        </div>
        <!--<div class="month-sale">月销 {{getMoneyStr(item.itemsale)}}</div>-->
      </div>
      <div class="footer">
        <div class="price" v-bind:class="{'has-share': showShare}">
          <div class="discount">券后价￥<strong>{{ Number(item.itemendprice) }}</strong></div>
          <div class="origin">￥{{ item.itemprice }}</div>
        </div>
        <div class="ticket">
          <span class="name">券</span><span
          class="value">￥{{ item.couponmoney }}</span>
        </div>
      
      </div>
      <div class="btn-block">
        <div class="btn-share">
          <span v-if="activeType !== Types.tb" class="operation" v-on:click.capture="share($event,item)">分享</span>
          <span v-else class="operation" v-on:click.capture="share($event,item)">立即下单</span>
        </div>
        <div class="btn-order" v-if="activeType !== Types.tb">
          <span v-if="item.stock == 0" class="operation sell-out">已抢完</span>
          <span v-else-if="item.stock == -1" class="operation sell-out">未开始</span>
          <span v-else class="operation" v-on:click.capture="buy($event,item)">立即下单</span>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
Vue.component("list-item", {
  template: "#c-list-item",
  props: {
    item: Object,
    type: {
      type: String,
      default: "tb" // tb || jd
    },
    showShare: {
      type: Boolean,
      default: false
    }
  },

  computed: {
    iconUrl: function() {
      return this.$parent.itemIcon;
    },
    Types: function() {
      return this.$parent.Types;
    },
    activeType: function() {
      return this.$parent.activeType;
    }
  },
  methods: {
    buy: function(e, item) {
      // this.$emit("buy", e, item);
      this.$parent.handleGoodsTransfer(e, item, "link");
    },
    share: function(e, item) {
      // this.$emit("share", e, item);
      this.$parent.handleGoodsTransfer(e, item, "copy");
    },
    getMoneyStr: function(num) {
      var w = 10000;
      if(num < w) return num;
      return (num / w).toFixed(2) + "万";
    }
  }
});
</script>
<div class="page-container" id="single-page-app" v-cloak><div class="banner-wrapper"><img class="free-banner" v-bind:src="banner" alt=""></div><div class="fixed-block max-width" v-sticky="{type:'fixed'}" key="fixed-block" ref="searchBox"><div class="search-box"><van-search v-model="search.value" show-action placeholder="搜索更多优惠" clear-trigger="always" v-on:search="onSearch" v-on:clear="onClear"><template slot="action"><div v-on:click="onSearch">搜索</div></template></van-search><ul class="hot-key"><li v-for="(item, index) in search.hotkey" v-bind:class="{active:item === search.value}" v-on:click="handleHotkey(item)">{{item}}</li></ul><ul class="share-box" ref="shareBox"><li v-for="(item, index) in shareList"><!--a(v-bind:href="item.url" target="_blank")--><img v-bind:src="item.image" v-on:click.capture="clickActivity($event, item)"></li></ul><ul class="nav"><li class="bg" v-bind:style="{left:activeNav.bgLeft}"></li><li class="item" v-for="(item, index) in nav.list" v-bind:style="{'background-image':'url('+activeNav.icon+')'}" v-bind:class="{active: nav.activeIndex === index}" v-on:click="onNavChange(index)"><span>{{item.label}}</span></li></ul></div></div><div class="page-content" ref="list" v-bind:class="{'empty-list':!listData.list.length}"><div class="free-lists"><template v-if="listData.list.length || listData.finished"><list-item class="free-item" v-for="(item, index) in listData.list" v-bind:item="item" v-bind:key="index" v-on:buy="handleGoodsTransfer($event,item,'link')" v-on:share="handleGoodsTransfer($event,item,'copy')"></list-item><!-- 底部提示 --><div class="list-item-loading"><span v-if="listData.finished">没有更多商品了~</span><span v-else>数据正在赶来的路上...</span></div></template><!-- 加载效果 --></div></div><share v-on:share="handleShare"></share><van-overlay v-bind:show="loading"><van-loading color="#0094ff"></van-loading></van-overlay></div><script>Vue.use(vant.Lazyload, {
  preLoad: 1.3,
  error: "http://img.bc.haodanku.com/haodanku/1595237918",
  loading: "http://img.bc.fqapps.com/fudai13cae4ae6ef16739ed3b100a2ec39e97.gif",
  attempt: 1
});

var listDataStr = JSON.stringify({
  list: [],
  loading: false,
  finished: false,
  min_id: 1,
  pageTotal: 1,
  pageCurrent: 0
});
var baseMixin = {
  el: "#single-page-app",
  data: function() {
    return {
      listData: JSON.parse(listDataStr)
    };
  },
  created: function() {
    this.getListData();
  },
  mounted: function() {
    var that = this;
    window.addEventListener("scroll", function(ev) {
      if(isScrollEnd(this, "vertical", 40)) {
        that.getListData();
      }
    });
  },
  methods: {
    resetListData: function() {
      this.listData = JSON.parse(listDataStr);
    },
    getListDataParams: function(item) {
      throw new Error("需要使用了该mixins的组件实现listDataParams函数");
    },
    getListData: function() {
      throw new Error("需要使用了该mixins的组件实现getListData函数");
    },
    getTransferParams: function() {
      throw new Error("需要使用了该mixins的组件实现transferParams函数");
    },
    handleGoodsTransfer: function() {
      throw new Error("需要使用了该mixins的组件实现handleGoodsTransfer函数");
    },
    /**
     * 分享给好友
     */
    handleShare: function() {
      copy(location.href, "复制成功，分享给身边好友吧~");
    },
  }
};var Types = {
  tb: "1",
  jd: "2",
  pdd: "3"
};
var indexMixin = (function() {
  var that;
  baseMixin.created = undefined;
  return {
    mixins: [baseMixin],
    directives: {
      sticky: sticky
    },
    data: function() {
      return {
        Types: Types,
        nav: {
          list: [
            {
              icon: "http://img-haodanku-com.cdn.fudaiapp.com/Fr1M4Lza1oC0203z1EbW1ag1T9MW",
              label: "淘宝",
              value: Types.tb,
              bgLeft: "0"
            },
            {
              icon: "http://img-haodanku-com.cdn.fudaiapp.com/FmqPTcpihPdiVcZ-0Gia_Foq7rb5",
              label: "京东",
              value: Types.jd,
              bgLeft: "38%"
            },
            {
              icon: "http://img-haodanku-com.cdn.fudaiapp.com/FnI_U9IfAmUtZs0OioDtypyY3ziR",
              label: "拼多多",
              value: Types.pdd,
              bgLeft: "76%"
            }
          ],
          activeIndex: 0
        },
        navFixed: false,
        banner: "http://img-haodanku-com.cdn.fudaiapp.com/FgR08eD9JxRqFocT9_IXkmf6zrnO",
        search: {
          value: "",
          hotkey: []
        },
        shareList: [],
        loading: false,
        transferUrl: createObj(
          [Types.tb, url("v2.api.haodanku.com/sourcecode_to_cid")],
          [Types.jd, url("v2.api.haodanku.com/get_jditems_link")],
          [Types.pdd, url("v2.api.haodanku.com/get_pdditems_link")]
        ) // 转链链接
      };
    },
    mounted: function() {
      that = this;
      this.getInitData();
    },
    computed: {
      activeNav: function() {
        return this.nav.list[this.nav.activeIndex];
      },
      activeType: function() {
        return this.activeNav.value;
      },
      itemIcon: function() {
        var icons = createObj(
          [Types.tb, "http://img-haodanku-com.cdn.fudaiapp.com/FvU9Lg74-WgBzWQphv98-9KgYF6d"],
          [Types.jd, "http://img-haodanku-com.cdn.fudaiapp.com/FieNXmZjc_io1YMTcsCbrxsQJBR0"],
          [Types.pdd, "http://img-haodanku-com.cdn.fudaiapp.com/Fpjf7JUJTCWNo7zm0RnZkLn6YQBq"]
        );
        return icons[this.activeType];
      }
    },
    methods: {
      scrollToList: function() {
        var top = this.$refs.list.offsetTop;
        var searchBoxHeight = this.$refs.searchBox.offsetHeight;
        window.scrollTo(0, top - searchBoxHeight);
      },
      onSearch: function() {
        that.scrollToList();
        this.reGetListData();
      },
      handleHotkey: function(hotkey) {
        this.search.value = hotkey;
        this.onSearch();
      },
      onClear: function() {
        this.onSearch();
      },
      onNavChange: function(index) {
        if(this.listData.loading || this.nav.activeIndex === index) return;
        this.nav.activeIndex = index;
        this.onSearch();
      },
      resetListData: function() {
        this.listData = {
          list: this.listData.list,
          loading: false,
          finished: false,
          min_id: 1
        };
      },
      reGetListData: function() {
        this.resetListData();
        return this.getListData(true);
      },
      /**
       * 获取商品数据
       * @param clean {boolean}
       */
      getListData: function(clean) {
        if(this.loading || this.listData.loading || this.listData.finished || this.cate_id === "") return;
        this.listData.loading = true;
        if(clean) {
          this.loading = true;
        }
        var params = Object.assign(
          {
            keyword: this.search.value,
            min_id: this.listData.min_id
          },
          this.getListDataParams());

        var urls = createObj(
          [Types.tb, url("v2.api.haodanku.com/supersearch")],
          [Types.jd, url("v2.api.haodanku.com/jd_goods_search")],
          [Types.pdd, url("v2.api.haodanku.com/pdd_goods_search")]
        );


        var obj = Request.get(urls[this.activeType], params);
        // this.getListDataAbort = obj.ajax.abort.bind(obj.ajax);
        obj.promise.then(function(res) {
          setTimeout(function() {
            if(clean) {
              that.listData.list = res.data || [];
            } else {
              that.listData.list = that.listData.list.concat(res.data || []);
            }
            that.listData.finished = that.listData.min_id == res.min_id || !Boolean(res.data && res.data.length);
            that.listData.min_id = res.min_id;
            // 微信浏览器 promise没有finally
            that.listData.loading = false;
            that.loading = false;
          }, 200);
        }).catch(function() {
          that.listData.finished = true;
          // 微信浏览器 promise没有finally
          that.listData.loading = false;
          that.loading = false;
        });
        return obj.promise;
      },
      /**
       * 商品转链
       * @param e {MouseEvent}
       * @param item
       * @param type {'copy'|'link'}
       */
      handleGoodsTransfer: function(e, item, type) {
        var el = e.currentTarget.parentNode;
        var match = createObj(
          [Types.tb, {key: "taoword", msg: "复制淘口令成功，请打开淘宝领取"}],
          [Types.jd, {key: "short_url", msg: "下单链接已复制成功，请前往微信下单"}],
          [Types.pdd, {key: "short_url", msg: "下单链接已复制成功，请前往微信下单"}]
        );

        var current = match[this.activeType];

        var exec = function() {
          if(!item.transferStr) return;
          if(type === "copy") {
            var copyText = item.transferStr;
            if(that.activeType === Types.tb) {
              copyText = "0" + (item.itemshorttitle || item.itemtitle) + copyText.substr(1);
            } else {
              copyText = item.goodsname + "<br>" + copyText;
            }

            // 换行
            var div = document.createElement("div");
            div.innerHTML = copyText;
            Object.assign(div.style, {
              position: "fixed",
              left: "-10000px",
              top: "-10000px"
            });
            document.body.appendChild(div);

            var rmDiv = function() {
              document.body.removeChild(div);
            };
            copy(div, current.msg, "复制失败,请点击重试", true).then(rmDiv, rmDiv);
          } else {
            window.location = item.transferStr;
          }
        };

        if(item.transferStr) {
          exec();
          return;
        }
        el.addEventListener("click", function() {
          exec();
          el.removeEventListener("click", arguments.callee, false);
        }, false);
        Request.postSync(
          this.transferUrl[this.activeType],
          this.getTransferParams(item),
          function(res) {
            if(this.activeType === Types.tb) {
              var code = res.data;
              if(res.data[current.key]) {
                code = "0" + res.data[current.key] + "/";
              }
              item.transferStr = code;
            } else {
              item.transferStr = res.data[current.key];
            }
            // exec();
          }.bind(this)
        ).promise.catch(function(res) {
          toast(res.msg || "转链失败");
        });
      },
      getInitData: function() {
        Request.get(url("api.haodanku.com/activity/search_activity_data")).promise.then(function(res) {
          that.shareList = res.data || [];
          that.search.hotkey = (res.hot_keyword || []).map(function(value) {
            return value.keyword;
          });
          if(that.search.hotkey.length) {
            that.reGetListData();
          }
        });
      },
      clickActivity: function(e, item) {
        var el = e.currentTarget.parentNode;
        var url = this.activityTransferUrl[item.type];
        var doCopy = function() {
          copy(item.copyText, "复制淘口令成功，请打开淘宝领取", "复制失败,请点击重试", true);
        };
        if(item.copyText) {
          doCopy();
          return;
        }
        el.addEventListener("click", function() {
          doCopy();
          el.removeEventListener("click", arguments.callee, false);
        }, false);
        Request.postSync(
          url,
          this.getActivityTransferParams(item),
          function(res) {
            if(item.type == Types.tb) {
              var code = res.data;
              if(res.data.tao_code) {
                code = "0" + res.data.tao_code + "/";
              }
              item.copyText = code;
            } else {
              window.location = res.data.short_url;
            }
          }.bind(this)
        ).promise.catch(function(res) {
          toast(res.msg || "转链失败");
        });
      },
      handleShare: function() {
        copy("我发现了一个神奇的网站,三大电商平台隐藏福利一键搜 " + location.href, "复制成功，分享给身边好友吧~");
      }
    }
  };
})();</script><script>new Vue({
  mixins: [indexMixin],
  data: function() {
    // 转链链接
    var transferUrl = createObj(
      [Types.tb, url("v2.api.haodanku.com/ratesurl")],
      [Types.jd, url("v2.api.haodanku.com/get_jditems_link")],
      [Types.pdd, url("v2.api.haodanku.com/get_pdditems_link")]
    )
    return {
      // 转链链接
      transferUrl: transferUrl,
      // 活动转链链接
      activityTransferUrl: createObj(
        [Types.tb, url('v2.api.haodanku.com/createConference_code')],
        [Types.jd, transferUrl[Types.jd]],
        [Types.pdd, url("v2.api.haodanku.com/pdd_activity_promotion")]
      ),
      // 公共参数
      commonParams: {
        apikey: "6318F9F7E76A",//必填
      },
      // 淘宝、京东、拼多多转链需填写参数
      typesParams: createObj(
        [Types.tb, {
          pid: 'mm_11529310_2189950137_111075150402', //必填
          tb_name: 'nutter312', //必填
          relation_id: '', //选填
        }],
        [Types.jd, {
          union_id: '1000619047',  //必填
        }],
        [Types.pdd, {
          pid: '20554272_207603761', //必填
        }]
      )
    }
  },
  methods: {
    // 列表参数 公共部分
    getListDataParams: function(item) {
      return this.commonParams;
    },
    // 转链参数
    getTransferParams: function(item) {
      var params = {};
      switch(this.activeType) {
        case Types.tb:
          params = Object.assign({
            itemid: item.itemid,
            title: item.itemshorttitle,
            activityid: item.activityid,
            get_taoword: 1
          }, this.typesParams[Types.tb]);
          break;
        case Types.jd:
          params = Object.assign({
            coupon_url: item.couponurl,
            material_id: item.skuid,
          }, this.typesParams[Types.jd]);
          break;
        case Types.pdd:
          params = Object.assign({
            goods_id: item.goods_id,
            goods_sign: item.goods_sign,
            zs_duo_id: item.zs_duo_id,
          }, this.typesParams[Types.pdd]);
      }
      return Object.assign({}, this.commonParams, params);
    },
    // 活动转链参数
    getActivityTransferParams: function(item) {
      switch(String(item.type)) {
        case Types.tb:
          return Object.assign(
            {
              activity_id: item.activity_id,
              title: item.name,
            },
            this.typesParams[Types.tb],
            this.commonParams
          );
        case Types.jd:
          return Object.assign({
              material_id: item.url,
              type: 2
            },
            this.typesParams[Types.jd],
            this.commonParams
          );
        case Types.pdd:
          return Object.assign({
              url: item.url,
              resource_type: item.activity_id
            },
            this.typesParams[Types.pdd],
            this.commonParams);
      }
    }
  }
})</script></body></html>